# コーディングプラクティス

## 原則

### 関数型アプローチ

- 純粋関数を優先
- 不変データ構造を使用
- 副作用を分離
- 型安全性を確保

### ドメイン駆動設計 (DDD)

- 値オブジェクトとエンティティを区別
- 集約で整合性を保証
- リポジトリでデータアクセスを抽象化
- 境界付けられたコンテキストを意識

### テスト駆動開発 (TDD)

- Red-Green-Refactor サイクル
- テストを仕様として扱う
- 小さな単位で反復
- 継続的なリファクタリング

### 使っていないものは消す

- 使用していない変数や関数は消す
- 使用していない import は消す
- 使用していないライブラリは消す
- 不要になったファイルは消す
- 先を見越して過剰な method を先に定義しない

## 実装パターン

### 値オブジェクト

- 不変
- 値に基づく同一性
- 自己検証
- ドメイン操作を持つ

### エンティティ

- ID に基づく同一性
- 制御された更新
- 整合性ルールを持つ

### リポジトリ

- ドメインモデルのみを扱う
- 永続化の詳細を隠蔽
- テスト用のインメモリ実装を提供

## 実装手順

1. **型設計**

   - まず型を定義
   - ドメインの言語を型で表現

2. **純粋関数から実装**

   - 外部依存のない関数を先に
   - テストを先に書く

3. **副作用を分離**

   - IO 操作は関数の境界に押し出す
   - 副作用を持つ処理を Promise でラップ

4. **アダプター実装**
   - 外部サービスや DB へのアクセスを抽象化
   - テスト用モックを用意

## ディレクトリ構成

### Package by Feature

機能単位でコードを整理し、関連するファイルをすべて同じフォルダにまとめる構造。
コンポーネント・hooks・サービス・型・テストなどを技術単位でディレクトリを分けるのではなく、機能単位でまとめることで、必要なファイルを一箇所で把握しやすくなる。
各 feature ディレクトリの内部でも package by feature の原則を適用する。
無理にディレクトリで分類する必要はなくフラットに配置すれば良い。7 個以上のファイルがある場合は、サブディレクトリを作成しても良い。

```
src/
  features/
    auth/
      LoginForm.tsx
      useLogin.ts
      service.ts
      types.ts
      test.ts
    user/
      UserProfile.tsx
      useUserProfile.ts
      service.ts
      types.ts
      test.ts
```

利点:

- 機能の変更が局所化される
- 関連するコードが近くにある
- 依存関係が明確になる
- 機能の削除が容易

## プラクティス

- 小さく始めて段階的に拡張
- 過度な抽象化を避ける
- コードよりも型を重視
- 複雑さに応じてアプローチを調整

## コードスタイル

- 関数優先（クラスは必要な場合のみ）
- 不変更新パターンの活用
- 早期リターンで条件分岐をフラット化
- エラーとユースケースの列挙型定義
- main 関数を上部に配置
- コミット前にコードフォーマットを実行

## テスト戦略

- 純粋関数の単体テストを優先
- インメモリ実装によるリポジトリテスト
- テスト可能性を設計に組み込む
- アサートファースト：期待結果から逆算
