# コーディングプラクティス

## 原則

### 関数型アプローチ

- 純粋関数を優先
- 不変データ構造を使用
- 副作用を分離
- 型安全性を確保

### ドメイン駆動設計 (DDD)

- 『Domain Modeling Made Functional』の原則に従う
- 過度な抽象化を避ける
- コードよりも型を重視

### テスト駆動開発 (TDD)

- Red-Green-Refactor サイクル
- テストを仕様として扱う
- 小さな単位で反復
- 継続的なリファクタリング

### 使用していないものは消す

- 使用していない変数や関数は消す
- 使用していない import は消す
- 使用していないライブラリは消す
- 不要になったファイルは消す
- 先を見越して過剰な method を先に定義しない

## 実装手順

1. **型設計**

   - まず型を定義
   - ドメインの言語を型で表現

2. **純粋関数から実装**

   - 外部依存のない関数を先に
   - テストを先に書く

3. **副作用を分離**

   - IO 操作は関数の境界に押し出す
   - 副作用を持つ処理を Promise でラップ

4. **アダプター実装**
   - 外部サービスや DB へのアクセスを抽象化
   - テスト用モックを用意

## ディレクトリ構成は Package by Feature

機能単位でコードを整理し、関連するファイルをすべて同じディレクトリにまとめる
技術単位でディレクトリを分けるのではなく、機能単位でまとめることで、必要なファイルを一箇所で把握しやすくなる。
各 feature ディレクトリの内部でも package by feature の原則を適用する。
各 feature ディレクトリの内部は無理にディレクトリで分類する必要はなくフラットに配置すれば良い。7 個以上のファイルがある場合は、サブディレクトリを作成しても良い。

```
src/
  features/
    auth/
      LoginForm.tsx
      useLogin.ts
      service.ts
      types.ts
      test.ts
    user/
      UserProfile.tsx
      useUserProfile.ts
      service.ts
      types.ts
      test.ts
```

原則として以下のような名称のディレクトリは作成しない

- components
- hooks
- services
- types
- tests
- etc.

## コードスタイル

- 基本的に関数で実装し、class は一切使用しない
- main 関数を上部に配置
- 関数を小さく分割し、一つの関数の内部は抽象度が揃った可読性の高いコードにする
- コミット前にコードフォーマットを実行
- 早期リターンで条件分岐をフラット化

## テスト戦略

- 純粋関数の単体テストを優先
- インメモリ実装によるリポジトリテスト
- テスト可能性を設計に組み込む
- アサートファースト：期待結果から逆算

## MVP を重視する実装方針

- MVP の作成を重視し、その後段階的に拡張する方針で進める
  - レビュー時に動作確認しやすい
  - 前もって不要にロジックを作りすぎるのを避けられる
- MVP を作成するために優先順位を判断して実装方針を提案する

## レビュー

- ユーザに確認を促す前に自分で動作確認やレビューを行う
- ユーザに確認を促す際は、動作確認の手順やレビューすべきポイントなども提示する
